\hypertarget{_microscope_8cpp_source}{}\subsection{Microscope.\+cpp}
\label{_microscope_8cpp_source}\index{/home/peer23peer/programmingspace/\+V\+S\+A/\+Vision\+Soil\+Analyzer/src/\+Soil\+Hardware/\+Microscope.\+cpp@{/home/peer23peer/programmingspace/\+V\+S\+A/\+Vision\+Soil\+Analyzer/src/\+Soil\+Hardware/\+Microscope.\+cpp}}

\begin{DoxyCode}
00001 \textcolor{comment}{/* Copyright (C) Jelle Spijker - All Rights Reserved}
00002 \textcolor{comment}{ * Unauthorized copying of this file, via any medium is strictly prohibited}
00003 \textcolor{comment}{ * and only allowed with the written consent of the author (Jelle Spijker)}
00004 \textcolor{comment}{ * This software is proprietary and confidential}
00005 \textcolor{comment}{ * Written by Jelle Spijker <spijker.jelle@gmail.com>, 2015}
00006 \textcolor{comment}{ */}
00007 
00008 \textcolor{preprocessor}{#include "\hyperlink{_microscope_8h}{Microscope.h}"}
00009 
00010 \textcolor{keyword}{namespace }\hyperlink{namespace_hardware}{Hardware} \{
00011 
\hypertarget{_microscope_8cpp_source_l00012}{}\hyperlink{class_hardware_1_1_microscope_a447e1c2d17d75090120b22ad6323de2a}{00012} \hyperlink{class_hardware_1_1_microscope_a447e1c2d17d75090120b22ad6323de2a}{Microscope::Microscope}() \{
00013   \hyperlink{class_hardware_1_1_microscope_a544911a6d1eec986001087e5d9278604}{RunEnv} = \hyperlink{class_hardware_1_1_microscope_a24538a26545c6138b2e922ed4feb9376}{GetCurrentArchitecture}();
00014   \hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams} = \hyperlink{class_hardware_1_1_microscope_a71a409aae67baf63fd27678eda462e38}{GetAvailableCams}();
00015   for\_each(\hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}.begin(), \hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}.end(), [](
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t}{Cam\_t} &C) \{
00016     C.SelectedResolution = &C.Resolutions[C.Resolutions.size() - 1];
00017   \});
00018   connect(\textcolor{keyword}{this}, SIGNAL(\hyperlink{class_hardware_1_1_microscope_a9ffc9b16e733b23c97d7dca4ef3210f5}{imageretrieved}()), \textcolor{keyword}{this}, SLOT(
      \hyperlink{class_hardware_1_1_microscope_a30346757ffd5d2f9d42b5a483842431e}{on\_imageretrieved}()));
00019 \}
00020 
\hypertarget{_microscope_8cpp_source_l00021}{}\hyperlink{class_hardware_1_1_microscope_a1f40641ce0c8dfc2611af33eeb985160}{00021} \hyperlink{class_hardware_1_1_microscope_a447e1c2d17d75090120b22ad6323de2a}{Microscope::Microscope}(\textcolor{keyword}{const} \hyperlink{class_hardware_1_1_microscope}{Microscope} &rhs) \{
00022   std::copy(rhs.\hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}.begin(), rhs.\hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}.end(),
00023             this->\hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}.begin());
00024   this->\hyperlink{class_hardware_1_1_microscope_a544911a6d1eec986001087e5d9278604}{RunEnv} = rhs.\hyperlink{class_hardware_1_1_microscope_a544911a6d1eec986001087e5d9278604}{RunEnv};
00025   this->\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam} = rhs.\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam};
00026   this->\hyperlink{class_hardware_1_1_microscope_a80c5ad94099d7b9d175e1a1cd4179fcd}{cap} = rhs.\hyperlink{class_hardware_1_1_microscope_a80c5ad94099d7b9d175e1a1cd4179fcd}{cap};
00027   this->\hyperlink{class_hardware_1_1_microscope_a2ca84cff524b286b3fb452c4bd813303}{fd} = rhs.\hyperlink{class_hardware_1_1_microscope_a2ca84cff524b286b3fb452c4bd813303}{fd};
00028   this->\hyperlink{class_hardware_1_1_microscope_a2c73db8010320428db3fd41d840dd0eb}{HDRframes} = rhs.\hyperlink{class_hardware_1_1_microscope_a2c73db8010320428db3fd41d840dd0eb}{HDRframes};
00029   connect(\textcolor{keyword}{this}, SIGNAL(\hyperlink{class_hardware_1_1_microscope_a9ffc9b16e733b23c97d7dca4ef3210f5}{imageretrieved}()), \textcolor{keyword}{this}, SLOT(
      \hyperlink{class_hardware_1_1_microscope_a30346757ffd5d2f9d42b5a483842431e}{on\_imageretrieved}()));
00030 \}
00031 
\hypertarget{_microscope_8cpp_source_l00032}{}\hyperlink{class_hardware_1_1_microscope_afb6b20021157077feaf8df0e465a1f0e}{00032} \hyperlink{class_hardware_1_1_microscope_afb6b20021157077feaf8df0e465a1f0e}{Microscope::~Microscope}() \{ \textcolor{keyword}{delete} \hyperlink{class_hardware_1_1_microscope_a80c5ad94099d7b9d175e1a1cd4179fcd}{cap}; \}
00033 
\hypertarget{_microscope_8cpp_source_l00034}{}\hyperlink{class_hardware_1_1_microscope_a24538a26545c6138b2e922ed4feb9376}{00034} \hyperlink{class_hardware_1_1_microscope_ae1afa6a1a1d5b560a5ad8f94c78a336b}{Microscope::Arch} \hyperlink{class_hardware_1_1_microscope_a24538a26545c6138b2e922ed4feb9376}{Microscope::GetCurrentArchitecture}() \{
00035   \textcolor{keyword}{struct }utsname unameData;
00036   \hyperlink{class_hardware_1_1_microscope_ae1afa6a1a1d5b560a5ad8f94c78a336b}{Arch} retVal;
00037   uname(&unameData);
00038   std::string archString = \textcolor{keyword}{static\_cast<}std::string\textcolor{keyword}{>}(unameData.machine);
00039   \textcolor{keywordflow}{if} (archString.find(\textcolor{stringliteral}{"armv7l"}) != string::npos) \{
00040     retVal = Arch::ARM;
00041   \} \textcolor{keywordflow}{else} \{
00042     retVal = Arch::X64;
00043   \}
00044   \textcolor{keywordflow}{return} retVal;
00045 \}
00046 
\hypertarget{_microscope_8cpp_source_l00047}{}\hyperlink{class_hardware_1_1_microscope_a71a409aae67baf63fd27678eda462e38}{00047} std::vector<Microscope::Cam\_t> \hyperlink{class_hardware_1_1_microscope_a71a409aae67baf63fd27678eda462e38}{Microscope::GetAvailableCams}() \{
00048   \textcolor{keyword}{const} \textcolor{keywordtype}{string} path\_ss = \textcolor{stringliteral}{"/sys/class/video4linux"};
00049   \textcolor{keyword}{const} \textcolor{keywordtype}{string} path\_ss\_dev = \textcolor{stringliteral}{"/dev/video"};
00050   std::vector<Cam\_t> retVal;
00051   \textcolor{keyword}{struct }v4l2\_queryctrl queryctrl;
00052   \textcolor{keyword}{struct }v4l2\_control controlctrl;
00053 
00054   \textcolor{comment}{// Check if there're videodevices installed}
00055   \textcolor{comment}{// Itterate through the cams}
00056   \textcolor{keywordflow}{for} (boost::filesystem::directory\_iterator itr(path\_ss);
00057        itr != boost::filesystem::directory\_iterator(); ++itr) \{
00058     \textcolor{keywordtype}{string} videoln = itr->path().string();
00059     videoln.append(\textcolor{stringliteral}{"/name"});
00060     \textcolor{keywordflow}{if} (boost::filesystem::exists(videoln)) \{
00061       \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t}{Cam\_t} currentCam;
00062       std::ifstream camName;
00063       camName.open(videoln);
00064       std::getline(camName, currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_abadd87f124923661f2e94d78cee3dbf4}{Name});
00065       camName.close();
00066       currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a870c5b29e3b987dce2a82308165cd178}{ID} =
00067           std::atoi(itr->path().string().substr(28, std::string::npos).c\_str());
00068 
00069       \textcolor{comment}{// Open Cam}
00070       currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab179002870eff0055f9f61b0bae276aa}{devString} = path\_ss\_dev + std::to\_string(currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a870c5b29e3b987dce2a82308165cd178}{ID});
00071       \textcolor{keywordflow}{if} ((currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd} = open(currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab179002870eff0055f9f61b0bae276aa}{devString}.c\_str(), O\_RDWR)) == -1) \{
00072         \textcolor{keywordflow}{throw} \hyperlink{class_hardware_1_1_exception_1_1_microscope_exception}{Exception::MicroscopeException}(
      \hyperlink{_microscope_not_found_exception_8h_ab454d881077ad1b9fa1ff6a97af31e8a}{EXCEPTION\_NOCAMS},
00073                                              \hyperlink{_microscope_not_found_exception_8h_aea497321765f9a7c7cafc933aff14866}{EXCEPTION\_NOCAMS\_NR});
00074       \}
00075 
00076       \textcolor{comment}{// Get controls}
00077       memset(&queryctrl, 0, \textcolor{keyword}{sizeof}(queryctrl));
00078       memset(&controlctrl, 0, \textcolor{keyword}{sizeof}(controlctrl));
00079       \textcolor{keywordflow}{for} (queryctrl.id = V4L2\_CID\_BASE; queryctrl.id < V4L2\_CID\_LASTP1;
00080            queryctrl.id++) \{
00081 
00082         \textcolor{keywordflow}{if} (ioctl(currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd}, VIDIOC\_QUERYCTRL, &queryctrl) == 0) \{
00083           \textcolor{keywordflow}{if} (!(queryctrl.flags & V4L2\_CTRL\_FLAG\_DISABLED)) \{
00084             \hyperlink{struct_hardware_1_1_microscope_1_1_control__t}{Control\_t} currentControl;
00085             currentControl.\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_a7eb33f4df690ac0f388be1305722576d}{ID} = queryctrl.id;
00086             currentControl.\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_a7e6d24c2ba366a688ede19b4309dff66}{name} = (\textcolor{keywordtype}{char} *)queryctrl.name;
00087             currentControl.\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_a3695825b54ec92981f3d9f7f5a6c6cac}{minimum} = queryctrl.minimum;
00088             currentControl.\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac9b27cf29b495f9539931166cc3b41e2}{maximum} = queryctrl.maximum;
00089             currentControl.\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_a6d10bf874987471188802081f0eb10f3}{default\_value} = queryctrl.default\_value;
00090             currentControl.\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_a3151af96b23b2f4d536c74da12d81049}{step} = queryctrl.step;
00091             controlctrl.id = queryctrl.id;
00092             if (ioctl(currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd}, VIDIOC\_G\_CTRL, &controlctrl) == 0) \{
00093               currentControl.\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac86486f4807d9c9e7fe75d1983b057d3}{current\_value} = controlctrl.value;
00094             \}
00095             currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab86ea92620f15288753a980b6f5d6c9f}{Controls}.push\_back(currentControl);
00096           \}
00097         \} \textcolor{keywordflow}{else} \{
00098           \textcolor{keywordflow}{if} (errno == EINVAL)
00099             \textcolor{keywordflow}{continue};
00100           \textcolor{keywordflow}{throw} \hyperlink{class_hardware_1_1_exception_1_1_microscope_exception}{Exception::MicroscopeException}(
      \hyperlink{_microscope_not_found_exception_8h_aff89937633d667a17b2bff80551e4574}{EXCEPTION\_QUERY},
00101                                                \hyperlink{_microscope_not_found_exception_8h_acb42acfdb2279208d47da5b3c3018f9d}{EXCEPTION\_QUERY\_NR});
00102         \}
00103       \}
00104 
00105       \hyperlink{class_hardware_1_1_microscope_ab4b24bd8062cafb1bfe47967ac66254e}{getResolutions}(currentCam, V4L2\_PIX\_FMT\_YUYV);
00106       \hyperlink{class_hardware_1_1_microscope_ab4b24bd8062cafb1bfe47967ac66254e}{getResolutions}(currentCam, V4L2\_PIX\_FMT\_MJPEG);
00107       \hyperlink{class_hardware_1_1_microscope_ab4b24bd8062cafb1bfe47967ac66254e}{getResolutions}(currentCam, V4L2\_PIX\_FMT\_GREY);
00108       close(currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd});
00109       retVal.push\_back(currentCam);
00110     \}
00111   \}
00112 
00113   \textcolor{keywordflow}{for} (\hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} i = 0; i < retVal.size(); i++) \{
00114     \textcolor{keywordflow}{if} (retVal[i].Resolutions.size() == 0) \{
00115       retVal.erase(retVal.begin() + i);
00116       i--;
00117     \}
00118   \}
00119 
00120   \textcolor{keywordflow}{return} retVal;
00121 \}
00122 
\hypertarget{_microscope_8cpp_source_l00123}{}\hyperlink{class_hardware_1_1_microscope_ab4b24bd8062cafb1bfe47967ac66254e}{00123} \textcolor{keywordtype}{void} \hyperlink{class_hardware_1_1_microscope_ab4b24bd8062cafb1bfe47967ac66254e}{Microscope::getResolutions}(\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t}{Cam\_t} &currentCam, \textcolor{keywordtype}{int} FormatType) \{
00124   \textcolor{comment}{// Get image formats}
00125   \textcolor{keyword}{struct }v4l2\_format format;
00126   memset(&format, 0, \textcolor{keyword}{sizeof}(format));
00127 
00128   \hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} width[10] = \{640,  800,  1280, 1280, 1920,
00129                         1600, 2048, 2560, 3840, 3872\};
00130   \hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} height[10] = \{480,  600,  720,  960,  1080,
00131                          1200, 1536, 1440, 2160, 2764\};
00132 
00133   \hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} ResolutionID = 0;
00134 
00135   \textcolor{keywordflow}{for} (\hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} i = 0; i < 10; i++) \{
00136     format.type = V4L2\_BUF\_TYPE\_VIDEO\_CAPTURE;
00137     format.fmt.pix.pixelformat = FormatType;
00138     format.fmt.pix.width = width[i];
00139     format.fmt.pix.height = height[i];
00140     \textcolor{keywordtype}{int} ret = ioctl(currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd}, VIDIOC\_S\_FMT, &format);
00141     \textcolor{keywordflow}{if} (ret != -1 && format.fmt.pix.height == height[i] &&
00142         format.fmt.pix.width == width[i]) \{
00143       \hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t}{Resolution\_t} res;
00144       res.\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a806e65c6ee59267a6a1c312c61a905dd}{Width} = format.fmt.pix.width;
00145       res.\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a0f56bb68dbaf77d47159e46d5384ee60}{Height} = height[i];
00146       res.\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a953e7a65311a4861b6db47b4faf74d4e}{ID} = ResolutionID++;
00147       \textcolor{keywordflow}{switch} (FormatType) \{
00148       \textcolor{keywordflow}{case} V4L2\_PIX\_FMT\_YUYV:
00149         res.\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a541b9faa798790e33aa42391d4b451b7}{format} = PixelFormat::YUYV;
00150         \textcolor{keywordflow}{break};
00151       \textcolor{keywordflow}{case} V4L2\_PIX\_FMT\_MJPEG:
00152         res.\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a541b9faa798790e33aa42391d4b451b7}{format} = PixelFormat::MJPG;
00153         \textcolor{keywordflow}{break};
00154       \textcolor{keywordflow}{case} V4L2\_PIX\_FMT\_GREY:
00155         res.\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a541b9faa798790e33aa42391d4b451b7}{format} = PixelFormat::GREY;
00156         \textcolor{keywordflow}{break};
00157       \textcolor{keywordflow}{default}:
00158         \textcolor{keywordflow}{break};
00159       \}
00160       currentCam.\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a28496beff27af86c6305e0dd950001e9}{Resolutions}.push\_back(res);
00161     \}
00162   \}
00163 \}
00164 
\hypertarget{_microscope_8cpp_source_l00165}{}\hyperlink{class_hardware_1_1_microscope_ae799dbdff39787d3226e8e8ce25386de}{00165} \textcolor{keywordtype}{bool} \hyperlink{class_hardware_1_1_microscope_ae799dbdff39787d3226e8e8ce25386de}{Microscope::IsOpened}() \{ \textcolor{keywordflow}{return} \hyperlink{class_hardware_1_1_microscope_ab1033afe167ab113639ea90c6b66544f}{openedUptheCam}; \}
00166 
\hypertarget{_microscope_8cpp_source_l00167}{}\hyperlink{class_hardware_1_1_microscope_a71ac92fc7c1cc19c7735a9c0b93b1eef}{00167} \textcolor{keywordtype}{bool} \hyperlink{class_hardware_1_1_microscope_a71ac92fc7c1cc19c7735a9c0b93b1eef}{Microscope::openCam}(\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t}{Cam\_t} *cam) \{
00168   \textcolor{keywordflow}{for} (\hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} i = 0; i < \hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}.size(); i++) \{
00169     \textcolor{keywordflow}{if} (\hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}[i] == *cam) \{
00170       \hyperlink{class_hardware_1_1_microscope_af59bbe16ae9efaaf05027ff35d900dee}{closeCam}(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam});
00171       \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam} = cam;
00172       \textcolor{keywordflow}{for} (Controls\_t::iterator it = \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab86ea92620f15288753a980b6f5d6c9f}{Controls}.begin();
00173            it != \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab86ea92620f15288753a980b6f5d6c9f}{Controls}.end(); ++it) \{
00174         \hyperlink{class_hardware_1_1_microscope_a3b963a4b53aae0e215a20e9d59493e48}{SetControl}(&*it);
00175       \}
00176 
00177       \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a8356f8298aaff0788bac41d1746eaaba}{currentMicroscope} = \textcolor{keyword}{this};
00178       gst\_init(NULL, NULL);
00179 
00180       \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aaf39f1862740897f67661ac21e22cc5d}{pipeline} = gst\_pipeline\_new(\textcolor{stringliteral}{"SoilCam"});
00181       \textcolor{keywordflow}{if} (!\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aaf39f1862740897f67661ac21e22cc5d}{pipeline}) \{
00182         \textcolor{keywordflow}{throw} \hyperlink{class_hardware_1_1_exception_1_1_microscope_exception}{Exception::MicroscopeException}(
00183             \hyperlink{_microscope_not_found_exception_8h_aeb9339c022da53faf12599857f661962}{EXCEPTION\_GSTREAM\_INIT\_EXCEPTION},
00184             \hyperlink{_microscope_not_found_exception_8h_acb49fd823d771758e1512edbae75c5c8}{EXCEPTION\_GSTREAM\_INIT\_EXCEPTION\_NR});
00185       \}
00186 
00187       \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a2bc62de54f6ee34ef2fda4f8b1f17808}{source} = gst\_element\_factory\_make(\textcolor{stringliteral}{"v4l2src"}, \textcolor{stringliteral}{"source"});
00188       \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ae1032439e4a4cffefd06929d5aa8d283}{capsfilter} =
00189           gst\_element\_factory\_make(\textcolor{stringliteral}{"capsfilter"}, \textcolor{stringliteral}{"filter"});
00190       \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ab745c37a5d761e71a8b60581d23284ec}{colorspace} =
00191           gst\_element\_factory\_make(\textcolor{stringliteral}{"ffmpegcolorspace"}, \textcolor{stringliteral}{"colorspace"});
00192       \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a6f1ebafe6122de462774fbe2d3d3e3bd}{convert} =
00193           gst\_element\_factory\_make(\textcolor{stringliteral}{"capsfilter"}, \textcolor{stringliteral}{"convert"});
00194       \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_afc35bf0fc822422a2b979fdfca74b14c}{sink} = gst\_element\_factory\_make(\textcolor{stringliteral}{"appsink"}, \textcolor{stringliteral}{"output"});
00195 
00196       \textcolor{keywordflow}{if} (!\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a2bc62de54f6ee34ef2fda4f8b1f17808}{source} || !\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ae1032439e4a4cffefd06929d5aa8d283}{capsfilter} ||
00197           !\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ab745c37a5d761e71a8b60581d23284ec}{colorspace} || !\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_afc35bf0fc822422a2b979fdfca74b14c}{sink} ||
00198           !\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a6f1ebafe6122de462774fbe2d3d3e3bd}{convert}) \{
00199         \textcolor{keywordflow}{throw} \hyperlink{class_hardware_1_1_exception_1_1_microscope_exception}{Exception::MicroscopeException}(
00200             \hyperlink{_microscope_not_found_exception_8h_a3b16a54d331309167dfedbf852b88c11}{EXCEPTION\_GSTREAM\_ELEM\_EXCEPTION},
00201             \hyperlink{_microscope_not_found_exception_8h_a1bc7e12fa98808c93e5ae73f44eaae6d}{EXCEPTION\_GSTREAM\_ELEM\_EXCEPTION\_NR});
00202       \}
00203 
00204       \textcolor{keywordflow}{if} (\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_abadd87f124923661f2e94d78cee3dbf4}{Name}.compare(\textcolor{stringliteral}{"DFK 24UJ003"}) == 0) \{
00205         \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a22c00ed28d0ebc1418b096f36d8f2d50}{tisvideobuffer} = gst\_element\_factory\_make(
00206             \textcolor{stringliteral}{"tisvideobufferfilter"}, \textcolor{stringliteral}{"tisvidebufferfilter"});
00207         \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aead275427306139fd257703992709499}{tiscolorize} =
00208             gst\_element\_factory\_make(\textcolor{stringliteral}{"tiscolorize"}, \textcolor{stringliteral}{"tiscolorize"});
00209         \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a035f8650ed7e1d28459fbbb8f680a4bf}{queue} = gst\_element\_factory\_make(\textcolor{stringliteral}{"queue"}, \textcolor{stringliteral}{"queue"});
00210         \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_af7aa9d3b405cad2f564537954c3b70e7}{bayer} =
00211             gst\_element\_factory\_make(\textcolor{stringliteral}{"bayer2rgb"}, \textcolor{stringliteral}{"bayer"});
00212         \textcolor{keywordflow}{if} (!\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a22c00ed28d0ebc1418b096f36d8f2d50}{tisvideobuffer} ||
00213             !\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aead275427306139fd257703992709499}{tiscolorize} || !
      \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a035f8650ed7e1d28459fbbb8f680a4bf}{queue} ||
00214             !\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_af7aa9d3b405cad2f564537954c3b70e7}{bayer}) \{
00215           \textcolor{keywordflow}{throw} \hyperlink{class_hardware_1_1_exception_1_1_microscope_exception}{Exception::MicroscopeException}(
00216               \hyperlink{_microscope_not_found_exception_8h_a3b16a54d331309167dfedbf852b88c11}{EXCEPTION\_GSTREAM\_ELEM\_EXCEPTION},
00217               \hyperlink{_microscope_not_found_exception_8h_a1bc7e12fa98808c93e5ae73f44eaae6d}{EXCEPTION\_GSTREAM\_ELEM\_EXCEPTION\_NR});
00218         \}
00219       \}
00220 
00221       g\_object\_set(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a2bc62de54f6ee34ef2fda4f8b1f17808}{source}, \textcolor{stringliteral}{"device"},
00222                    \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab179002870eff0055f9f61b0bae276aa}{devString}.c\_str());
00223 
00224       \textcolor{keywordflow}{switch} (\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a541b9faa798790e33aa42391d4b451b7}{format}) \{
00225       \textcolor{keywordflow}{case} PixelFormat::MJPG:
00226         \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ad068f72fc8487744c2e5e71e9096abf1}{caps} = gst\_caps\_new\_simple(
00227             \textcolor{stringliteral}{"video/x-raw-rgb"}, \textcolor{stringliteral}{"width"}, G\_TYPE\_INT,
00228             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a806e65c6ee59267a6a1c312c61a905dd}{Width}, \textcolor{stringliteral}{"height"}, G\_TYPE\_INT,
00229             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a0f56bb68dbaf77d47159e46d5384ee60}{Height}, NULL);
00230       \textcolor{keywordflow}{case} PixelFormat::GREY:
00231         \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ad068f72fc8487744c2e5e71e9096abf1}{caps} = gst\_caps\_new\_simple(
00232             \textcolor{stringliteral}{"video/x-raw-gray"}, \textcolor{stringliteral}{"width"}, G\_TYPE\_INT,
00233             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a806e65c6ee59267a6a1c312c61a905dd}{Width}, \textcolor{stringliteral}{"height"}, G\_TYPE\_INT,
00234             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a0f56bb68dbaf77d47159e46d5384ee60}{Height}, NULL);
00235         \textcolor{keywordflow}{break};
00236       \textcolor{keywordflow}{case} PixelFormat::YUYV:
00237         \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ad068f72fc8487744c2e5e71e9096abf1}{caps} = gst\_caps\_new\_simple(
00238             \textcolor{stringliteral}{"video/x-raw-gray"}, \textcolor{stringliteral}{"format"}, G\_TYPE\_STRING, \textcolor{stringliteral}{"(fourcc)UYVY"},
00239             \textcolor{stringliteral}{"width"}, G\_TYPE\_INT, \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a806e65c6ee59267a6a1c312c61a905dd}{Width},
00240             \textcolor{stringliteral}{"height"}, G\_TYPE\_INT, \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a0f56bb68dbaf77d47159e46d5384ee60}{Height},
00241             NULL);
00242       \textcolor{keywordflow}{default}:
00243         \textcolor{keywordflow}{break};
00244       \}
00245       g\_object\_set(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ae1032439e4a4cffefd06929d5aa8d283}{capsfilter}, \textcolor{stringliteral}{"caps"}, 
      \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ad068f72fc8487744c2e5e71e9096abf1}{caps},
00246                    NULL);
00247       gst\_caps\_unref(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ad068f72fc8487744c2e5e71e9096abf1}{caps});
00248       \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ad068f72fc8487744c2e5e71e9096abf1}{caps} = gst\_caps\_new\_simple(
00249           \textcolor{stringliteral}{"video/x-raw-rgb"}, \textcolor{stringliteral}{"width"}, G\_TYPE\_INT,
00250           \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a806e65c6ee59267a6a1c312c61a905dd}{Width}, \textcolor{stringliteral}{"height"}, G\_TYPE\_INT,
00251           \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a0f56bb68dbaf77d47159e46d5384ee60}{Height}, NULL);
00252       g\_object\_set(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a6f1ebafe6122de462774fbe2d3d3e3bd}{convert}, \textcolor{stringliteral}{"caps"}, 
      \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ad068f72fc8487744c2e5e71e9096abf1}{caps},
00253                    NULL);
00254 
00255       \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a92300301898e4dbcedf3d74ca3db3825}{bus} = gst\_element\_get\_bus(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aaf39f1862740897f67661ac21e22cc5d}{pipeline});
00256       g\_object\_set(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_afc35bf0fc822422a2b979fdfca74b14c}{sink}, \textcolor{stringliteral}{"emit-signals"}, TRUE, NULL);
00257       g\_signal\_connect(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_afc35bf0fc822422a2b979fdfca74b14c}{sink}, \textcolor{stringliteral}{"new-buffer"},
00258                        G\_CALLBACK(\hyperlink{class_hardware_1_1_microscope_a857987ccdcdb8d6b3cb9545eb7a616e8}{new\_buffer}), &\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe});
00259 
00260       \textcolor{keywordflow}{if} (\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_abadd87f124923661f2e94d78cee3dbf4}{Name}.compare(\textcolor{stringliteral}{"DFK 24UJ003"}) == 0) \{
00261         gst\_bin\_add\_many(GST\_BIN(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aaf39f1862740897f67661ac21e22cc5d}{pipeline}),
00262                          \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a2bc62de54f6ee34ef2fda4f8b1f17808}{source}, 
      \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ae1032439e4a4cffefd06929d5aa8d283}{capsfilter},
00263                          \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a22c00ed28d0ebc1418b096f36d8f2d50}{tisvideobuffer},
00264                          \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aead275427306139fd257703992709499}{tiscolorize}, 
      \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a035f8650ed7e1d28459fbbb8f680a4bf}{queue},
00265                          \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_af7aa9d3b405cad2f564537954c3b70e7}{bayer}, 
      \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_afc35bf0fc822422a2b979fdfca74b14c}{sink}, NULL);
00266         gst\_element\_link\_many(
00267             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a2bc62de54f6ee34ef2fda4f8b1f17808}{source}, \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ae1032439e4a4cffefd06929d5aa8d283}{capsfilter},
00268             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a22c00ed28d0ebc1418b096f36d8f2d50}{tisvideobuffer}, 
      \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aead275427306139fd257703992709499}{tiscolorize},
00269             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a035f8650ed7e1d28459fbbb8f680a4bf}{queue}, \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_af7aa9d3b405cad2f564537954c3b70e7}{bayer},
00270             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_afc35bf0fc822422a2b979fdfca74b14c}{sink}, NULL);
00271       \} \textcolor{keywordflow}{else} \{
00272         gst\_bin\_add\_many(
00273             GST\_BIN(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aaf39f1862740897f67661ac21e22cc5d}{pipeline}), 
      \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a2bc62de54f6ee34ef2fda4f8b1f17808}{source},
00274             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ae1032439e4a4cffefd06929d5aa8d283}{capsfilter}, \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ab745c37a5d761e71a8b60581d23284ec}{colorspace},
00275             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a6f1ebafe6122de462774fbe2d3d3e3bd}{convert}, \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_afc35bf0fc822422a2b979fdfca74b14c}{sink}, NULL);
00276         gst\_element\_link\_many(
00277             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a2bc62de54f6ee34ef2fda4f8b1f17808}{source}, \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ae1032439e4a4cffefd06929d5aa8d283}{capsfilter},
00278             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_ab745c37a5d761e71a8b60581d23284ec}{colorspace}, \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a6f1ebafe6122de462774fbe2d3d3e3bd}{convert},
00279             \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_afc35bf0fc822422a2b979fdfca74b14c}{sink}, NULL);
00280       \}
00281       \hyperlink{class_hardware_1_1_microscope_ab1033afe167ab113639ea90c6b66544f}{openedUptheCam} = \textcolor{keyword}{true};
00282       \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00283     \}
00284   \}
00285   \hyperlink{class_hardware_1_1_microscope_ab1033afe167ab113639ea90c6b66544f}{openedUptheCam} = \textcolor{keyword}{false};
00286   \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00287 \}
00288 
\hypertarget{_microscope_8cpp_source_l00289}{}\hyperlink{class_hardware_1_1_microscope_abd1bb8c3f37dac9f06b0d61cba98ac0a}{00289} \textcolor{keywordtype}{bool} \hyperlink{class_hardware_1_1_microscope_a71ac92fc7c1cc19c7735a9c0b93b1eef}{Microscope::openCam}(std::string &cam) \{ \textcolor{keywordflow}{return} \hyperlink{class_hardware_1_1_microscope_a71ac92fc7c1cc19c7735a9c0b93b1eef}{openCam}(
      \hyperlink{class_hardware_1_1_microscope_a64f57bcfcf93d75f7a27d0723487f35b}{FindCam}(cam)); \}
00290 
\hypertarget{_microscope_8cpp_source_l00291}{}\hyperlink{class_hardware_1_1_microscope_a7298405c4115400b8d949703b0bcad0c}{00291} \textcolor{keywordtype}{bool} \hyperlink{class_hardware_1_1_microscope_a71ac92fc7c1cc19c7735a9c0b93b1eef}{Microscope::openCam}(\textcolor{keywordtype}{int} &cam) \{ \textcolor{keywordflow}{return} \hyperlink{class_hardware_1_1_microscope_a71ac92fc7c1cc19c7735a9c0b93b1eef}{openCam}(
      \hyperlink{class_hardware_1_1_microscope_a64f57bcfcf93d75f7a27d0723487f35b}{FindCam}(cam)); \}
00292 
\hypertarget{_microscope_8cpp_source_l00293}{}\hyperlink{class_hardware_1_1_microscope_a2050e5699079f24b73a91245441c63ca}{00293} \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t}{Microscope::Cam\_t} *\hyperlink{class_hardware_1_1_microscope_a64f57bcfcf93d75f7a27d0723487f35b}{Microscope::FindCam}(\textcolor{keywordtype}{int} cam) \{
00294   \textcolor{keywordflow}{for} (\hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} i = 0; i < \hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}.size(); i++) \{
00295     \textcolor{keywordflow}{if} (cam == \hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}[i].ID) \{
00296       \textcolor{keywordflow}{return} &\hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}[i];
00297     \}
00298   \}
00299   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};
00300 \}
00301 
00302 \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t}{Microscope::Cam\_t} *\hyperlink{class_hardware_1_1_microscope_a64f57bcfcf93d75f7a27d0723487f35b}{Microscope::FindCam}(\textcolor{keywordtype}{string} cam) \{
00303   \textcolor{keywordflow}{for} (\hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} i = 0; i < \hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}.size(); i++) \{
00304     \textcolor{keywordflow}{if} (cam.compare(\hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}[i].Name) == 0) \{
00305       \textcolor{keywordflow}{return} &\hyperlink{class_hardware_1_1_microscope_a49a52c74d900f217ed190d36b29ff27d}{AvailableCams}[i];
00306     \}
00307   \}
00308   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};
00309 \}
00310 
\hypertarget{_microscope_8cpp_source_l00311}{}\hyperlink{class_hardware_1_1_microscope_af59bbe16ae9efaaf05027ff35d900dee}{00311} \textcolor{keywordtype}{bool} \hyperlink{class_hardware_1_1_microscope_af59bbe16ae9efaaf05027ff35d900dee}{Microscope::closeCam}(\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t}{Cam\_t} *cam) \{
00312   \textcolor{keywordflow}{if} (\hyperlink{class_hardware_1_1_microscope_ab1033afe167ab113639ea90c6b66544f}{openedUptheCam}) \{
00313     gst\_element\_set\_state(cam->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aaf39f1862740897f67661ac21e22cc5d}{pipeline}, GST\_STATE\_NULL);
00314     gst\_object\_unref(GST\_OBJECT(cam->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aaf39f1862740897f67661ac21e22cc5d}{pipeline}));
00315     \hyperlink{class_hardware_1_1_microscope_ab1033afe167ab113639ea90c6b66544f}{openedUptheCam} = \textcolor{keyword}{false};
00316   \}
00317 \}
00318 
\hypertarget{_microscope_8cpp_source_l00319}{}\hyperlink{class_hardware_1_1_microscope_a1ec5c792320ae4db3f3b39830e74f880}{00319} \textcolor{keywordtype}{void} \hyperlink{class_hardware_1_1_microscope_a1ec5c792320ae4db3f3b39830e74f880}{Microscope::GetFrame}(cv::Mat &dst) \{
00320   \textcolor{keywordflow}{if} (!\hyperlink{class_hardware_1_1_microscope_ae799dbdff39787d3226e8e8ce25386de}{IsOpened}()) \{
00321       \hyperlink{class_hardware_1_1_microscope_a71ac92fc7c1cc19c7735a9c0b93b1eef}{openCam}(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam});
00322     \}
00323   QEventLoop loop;
00324   loop.connect(\textcolor{keyword}{this}, SIGNAL(\hyperlink{class_hardware_1_1_microscope_a9ffc9b16e733b23c97d7dca4ef3210f5}{imageretrieved}()), SLOT(quit()));
00325   gst\_element\_set\_state(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a5cadb56c325736da812520b51c7fd65c}{Pipe}.\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_aaf39f1862740897f67661ac21e22cc5d}{pipeline}, GST\_STATE\_PLAYING);
00326   loop.exec();
00327   dst = \hyperlink{class_hardware_1_1_microscope_afd9597ab8447b75fdf5e74783fdcf7b2}{lastFrame};
00328   \hyperlink{class_hardware_1_1_microscope_af59bbe16ae9efaaf05027ff35d900dee}{closeCam}(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam});
00329 \}
00330 
\hypertarget{_microscope_8cpp_source_l00331}{}\hyperlink{class_hardware_1_1_microscope_a30346757ffd5d2f9d42b5a483842431e}{00331} \textcolor{keywordtype}{void} \hyperlink{class_hardware_1_1_microscope_a30346757ffd5d2f9d42b5a483842431e}{Microscope::on\_imageretrieved}() \{ \textcolor{keywordflow}{return}; \}
00332 
\hypertarget{_microscope_8cpp_source_l00333}{}\hyperlink{class_hardware_1_1_microscope_a1287dba9130379a9e7d035eeaf47d059}{00333} \textcolor{keywordtype}{void} \hyperlink{class_hardware_1_1_microscope_a1287dba9130379a9e7d035eeaf47d059}{Microscope::GetHDRFrame}(cv::Mat &dst, \hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} noframes) \{
00334   \textcolor{comment}{// create the brightness steps}
00335   \hyperlink{struct_hardware_1_1_microscope_1_1_control__t}{Control\_t} *brightness = \hyperlink{class_hardware_1_1_microscope_abc794f35d5b68458634507bf7e90e501}{GetControl}(\textcolor{stringliteral}{"Brightness"});
00336   \hyperlink{struct_hardware_1_1_microscope_1_1_control__t}{Control\_t} *contrast = \hyperlink{class_hardware_1_1_microscope_abc794f35d5b68458634507bf7e90e501}{GetControl}(\textcolor{stringliteral}{"Contrast"});
00337 
00338   \hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} brightnessStep =
00339       (brightness->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac9b27cf29b495f9539931166cc3b41e2}{maximum} - brightness->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_a3695825b54ec92981f3d9f7f5a6c6cac}{minimum}) / noframes;
00340   int8\_t currentBrightness = brightness->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac86486f4807d9c9e7fe75d1983b057d3}{current\_value};
00341   int8\_t currentContrast = contrast->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac86486f4807d9c9e7fe75d1983b057d3}{current\_value};
00342   contrast->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac86486f4807d9c9e7fe75d1983b057d3}{current\_value} = contrast->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac9b27cf29b495f9539931166cc3b41e2}{maximum};
00343 
00344   cv::Mat currentImg;
00345   \textcolor{comment}{// take the shots at different brightness levels}
00346   \textcolor{keywordflow}{for} (\hyperlink{_soil_math_types_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} i = 1; i <= noframes; i++) \{
00347     brightness->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac86486f4807d9c9e7fe75d1983b057d3}{current\_value} = brightness->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_a3695825b54ec92981f3d9f7f5a6c6cac}{minimum} + (i * brightnessStep);
00348     \hyperlink{class_hardware_1_1_microscope_a1ec5c792320ae4db3f3b39830e74f880}{GetFrame}(currentImg);
00349     \hyperlink{class_hardware_1_1_microscope_a2c73db8010320428db3fd41d840dd0eb}{HDRframes}.push\_back(currentImg);
00350   \}
00351 
00352   \textcolor{comment}{// Set the brightness and back to the previous used level}
00353   brightness->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac86486f4807d9c9e7fe75d1983b057d3}{current\_value} = currentBrightness;
00354   contrast->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac86486f4807d9c9e7fe75d1983b057d3}{current\_value} = currentContrast;
00355 
00356   \textcolor{comment}{// Perform the exposure fusion}
00357   cv::Mat fusion;
00358   cv::Ptr<cv::MergeMertens> merge\_mertens = cv::createMergeMertens();
00359   merge\_mertens->process(\hyperlink{class_hardware_1_1_microscope_a2c73db8010320428db3fd41d840dd0eb}{HDRframes}, fusion);
00360   fusion *= 255;
00361   fusion.convertTo(dst, CV\_8UC1);
00362 \}
00363 
\hypertarget{_microscope_8cpp_source_l00364}{}\hyperlink{class_hardware_1_1_microscope_abc794f35d5b68458634507bf7e90e501}{00364} \hyperlink{struct_hardware_1_1_microscope_1_1_control__t}{Microscope::Control\_t} *\hyperlink{class_hardware_1_1_microscope_abc794f35d5b68458634507bf7e90e501}{Microscope::GetControl}(\textcolor{keyword}{const} \textcolor{keywordtype}{string} name)
       \{
00365   \textcolor{keywordflow}{for} (Controls\_t::iterator it = \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab86ea92620f15288753a980b6f5d6c9f}{Controls}.begin();
00366        it != \hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab86ea92620f15288753a980b6f5d6c9f}{Controls}.end(); ++it) \{
00367     \textcolor{keywordflow}{if} (name.compare(it->name) == 0) \{
00368       \textcolor{keywordflow}{return} &*it;
00369     \}
00370   \}
00371   \textcolor{keywordflow}{return} \textcolor{keyword}{nullptr};
00372 \}
00373 
\hypertarget{_microscope_8cpp_source_l00374}{}\hyperlink{class_hardware_1_1_microscope_a3b963a4b53aae0e215a20e9d59493e48}{00374} \textcolor{keywordtype}{void} \hyperlink{class_hardware_1_1_microscope_a3b963a4b53aae0e215a20e9d59493e48}{Microscope::SetControl}(\hyperlink{struct_hardware_1_1_microscope_1_1_control__t}{Control\_t} *control) \{
00375   \textcolor{keywordflow}{if} ((\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd} = open(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab179002870eff0055f9f61b0bae276aa}{devString}.c\_str(), O\_RDWR)) == 
      -1) \{
00376     \textcolor{keywordflow}{throw} \hyperlink{class_hardware_1_1_exception_1_1_microscope_exception}{Exception::MicroscopeException}(
      \hyperlink{_microscope_not_found_exception_8h_ab454d881077ad1b9fa1ff6a97af31e8a}{EXCEPTION\_NOCAMS}, \hyperlink{_microscope_not_found_exception_8h_aea497321765f9a7c7cafc933aff14866}{EXCEPTION\_NOCAMS\_NR});
00377   \}
00378 
00379   \textcolor{keyword}{struct }v4l2\_queryctrl queryctrl;
00380   \textcolor{keyword}{struct }v4l2\_control controlctrl;
00381 
00382   memset(&queryctrl, 0, \textcolor{keyword}{sizeof}(queryctrl));
00383   queryctrl.id = control->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_a7eb33f4df690ac0f388be1305722576d}{ID};
00384   \textcolor{keywordflow}{if} (ioctl(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd}, VIDIOC\_QUERYCTRL, &queryctrl) == -1) \{
00385     \textcolor{keywordflow}{if} (errno != EINVAL) \{
00386       close(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd});
00387       \textcolor{keywordflow}{throw} \hyperlink{class_hardware_1_1_exception_1_1_microscope_exception}{Exception::MicroscopeException}(
      \hyperlink{_microscope_not_found_exception_8h_aff89937633d667a17b2bff80551e4574}{EXCEPTION\_QUERY}, \hyperlink{_microscope_not_found_exception_8h_acb42acfdb2279208d47da5b3c3018f9d}{EXCEPTION\_QUERY\_NR});
00388     \} \textcolor{keywordflow}{else} \{
00389       close(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd});
00390       \textcolor{keywordflow}{throw} \hyperlink{class_hardware_1_1_exception_1_1_microscope_exception}{Exception::MicroscopeException}(
      \hyperlink{_microscope_not_found_exception_8h_ab2f26cdb6306df3f23ca653407f10cdf}{EXCEPTION\_CTRL\_NOT\_FOUND},
00391                                            \hyperlink{_microscope_not_found_exception_8h_a394040cb4491689f2ad71244f548d8c3}{EXCEPTION\_CTRL\_NOT\_FOUND\_NR});
00392     \}
00393   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (queryctrl.flags & V4L2\_CTRL\_FLAG\_DISABLED) \{
00394     close(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd});
00395     \textcolor{keywordflow}{throw} \hyperlink{class_hardware_1_1_exception_1_1_microscope_exception}{Exception::MicroscopeException}(
      \hyperlink{_microscope_not_found_exception_8h_ab2f26cdb6306df3f23ca653407f10cdf}{EXCEPTION\_CTRL\_NOT\_FOUND},
00396                                          \hyperlink{_microscope_not_found_exception_8h_a394040cb4491689f2ad71244f548d8c3}{EXCEPTION\_CTRL\_NOT\_FOUND\_NR});
00397   \} \textcolor{keywordflow}{else} \{
00398     memset(&controlctrl, 0, \textcolor{keyword}{sizeof}(controlctrl));
00399     controlctrl.id = control->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_a7eb33f4df690ac0f388be1305722576d}{ID};
00400     controlctrl.value = control->\hyperlink{struct_hardware_1_1_microscope_1_1_control__t_ac86486f4807d9c9e7fe75d1983b057d3}{current\_value};
00401 
00402     \textcolor{keywordflow}{if} (ioctl(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd}, VIDIOC\_S\_CTRL, &controlctrl) == -1) \{
00403       \textcolor{comment}{// Fails on auto white balance}
00404       \textcolor{comment}{// throw Exception::MicroscopeException(EXCEPTION\_CTRL\_VALUE,}
00405       \textcolor{comment}{//                                     EXCEPTION\_CTRL\_VALUE\_NR);}
00406     \}
00407   \}
00408   close(\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->\hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_ab8d692f05f97f5f3cc0401f750d9ad2e}{fd});
00409 \}
00410 
\hypertarget{_microscope_8cpp_source_l00411}{}\hyperlink{class_hardware_1_1_microscope_ada1437dd2c64a0dc6f8b9e92187108f9}{00411} \textcolor{keywordtype}{void} \hyperlink{class_hardware_1_1_microscope_ada1437dd2c64a0dc6f8b9e92187108f9}{Microscope::SendImageRetrieved}() \{ emit 
      \hyperlink{class_hardware_1_1_microscope_a9ffc9b16e733b23c97d7dca4ef3210f5}{imageretrieved}(); \}
00412 
\hypertarget{_microscope_8cpp_source_l00413}{}\hyperlink{class_hardware_1_1_microscope_a857987ccdcdb8d6b3cb9545eb7a616e8}{00413} \textcolor{keywordtype}{void} \hyperlink{class_hardware_1_1_microscope_a857987ccdcdb8d6b3cb9545eb7a616e8}{Microscope::new\_buffer}(GstElement *sink, \hyperlink{struct_hardware_1_1_microscope_1_1___custom_data}{CustomData} *data) \{
00414   GstBuffer *buffer;
00415   g\_signal\_emit\_by\_name(sink, \textcolor{stringliteral}{"pull-buffer"}, &buffer);
00416   \textcolor{keywordflow}{if} (buffer) \{
00417     cv::Mat bufferMat(
00418         data->\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a8356f8298aaff0788bac41d1746eaaba}{currentMicroscope}->\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a0f56bb68dbaf77d47159e46d5384ee60}{Height},
00419         data->\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a8356f8298aaff0788bac41d1746eaaba}{currentMicroscope}->\hyperlink{class_hardware_1_1_microscope_a059d62ec28e85f1c3f3225c9c78a877f}{SelectedCam}->
      \hyperlink{struct_hardware_1_1_microscope_1_1_cam__t_a85e4d902ee8a096450dbe544ec0ce773}{SelectedResolution}->\hyperlink{struct_hardware_1_1_microscope_1_1_resolution__t_a806e65c6ee59267a6a1c312c61a905dd}{Width},
00420         CV\_8UC4, (\hyperlink{_soil_math_types_8h_a65f85814a8290f9797005d3b28e7e5fc}{uchar} *)buffer->data);
00421     std::vector<cv::Mat> chans;
00422     cv::split(bufferMat, chans);
00423     chans.erase(chans.begin() + 4);
00424     cv::merge(chans, data->\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a8356f8298aaff0788bac41d1746eaaba}{currentMicroscope}->\hyperlink{class_hardware_1_1_microscope_afd9597ab8447b75fdf5e74783fdcf7b2}{lastFrame});
00425     cv::namedWindow(\textcolor{stringliteral}{"test"});
00426     cv::imshow(\textcolor{stringliteral}{"test"}, data->\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a8356f8298aaff0788bac41d1746eaaba}{currentMicroscope}->\hyperlink{class_hardware_1_1_microscope_afd9597ab8447b75fdf5e74783fdcf7b2}{lastFrame});
00427     cv::waitKey(0);
00428     data->\hyperlink{struct_hardware_1_1_microscope_1_1___custom_data_a8356f8298aaff0788bac41d1746eaaba}{currentMicroscope}->\hyperlink{class_hardware_1_1_microscope_ada1437dd2c64a0dc6f8b9e92187108f9}{SendImageRetrieved}();
00429     \textcolor{comment}{//      gst\_element\_set\_state(data->currentMicroscope->SelectedCam->Pipe.pipeline,}
00430     \textcolor{comment}{//                          GST\_STATE\_PAUSED);}
00431     gst\_buffer\_unref(buffer);
00432   \}
00433 \}
00434 \}
\end{DoxyCode}
